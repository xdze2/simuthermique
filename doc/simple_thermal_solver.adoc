# Math

:stem: latexmath

## Model formulation
Linear, constant coefficent. All nodes are non-zero thermal mass.

- stem:[T(t)] : Temperature vector to solve for (internal nodes)
- stem:[M] : Matrix of thermal masses
- stem:[K = A^TCA] : Conduction matrix, 
- stem:[\phi(t)] : Vector of direct heat source (or sink)
- stem:[H] : Conduction between internal node and external nodes 
- stem:[T_{ext}(t)] : Fixed external temperatures


The model equation is:

[stem]
++++
M  \frac{dT}{dt}  = -K\times T - H\times (T - T_{ext}) + \phi 
++++


Model input parameters are:

- thermal mass: name, mass
- external node: name, T_ext(t)
- conduction link: node_a, node_b, k
- source: node_name, phi(t)


## Time integration

General initial value problem equation:

[stem]
++++
\frac{dT}{dt}  = f(T, t) 
++++


Time discretization using theta-method (time step k), where θ is a constant chosen between 0 and 1:

[stem]
++++
\frac{dT}{dt} \approx  \frac{T^{k+1} - T^k}{\Delta t} 
    \approx \theta f(T^{k+1}, t^{k+1}) + (1-\theta)f(T^k, t^k)
++++


- stem:[\theta=0] : Forward Euler (explicit, 1st order)
- stem:[\theta=1/2] : Crank-Nicolson (implicit, 2nd order)
- stem:[\theta = 1] : Backward Euler (implicit, 1st order)

NOTE: "Remark 2: The Crank-Nicolson scheme is second order accurate but gives slowly decaying oscillations for large eigenvalues. It is unsuitable for parabolic problems with rapidly decaying transients. The θ=1 scheme damps all components, and should be used in the initial steps."  From http://www.csc.kth.se/utbildning/kth/kurser/DN2255/ndiff13/Lecture3.pdf






The model equation is simplified to:

[stem]
++++
M  \frac{dT}{dt}  = -\tilde K \times  T(t) + S(t)
++++

with stem:[\tilde K =  K + H] and  stem:[S =  \phi + HT_{ext}]




[stem]
++++
( M/{\Delta t} + \theta K ) T^{k+1} = ( M/{\Delta t} - (1-\theta) K ) T^{k} + \theta S^{k+1} + (1-\theta) S^{k}
++++


Solve Ax = b, or inv(A)*b ? vs odeint ? 